<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plotting MCMC draws using the bayesplot package • bayesplot</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">bayesplot</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/users/interfaces/rstan.html">rstan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/rstanarm.html">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/shinystan.html">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/loo.html">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/users/interfaces/rstantools.html">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/rstanarm">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Plotting MCMC draws using the bayesplot package</h1>
                        <h4 class="author">Jonah Gabry</h4>
            
            <h4 class="date">2017-06-16</h4>
          </div>

    
    
<div class="contents">
<p>This vignette focuses on plotting parameter estimates from MCMC draws. MCMC diagnostic plots are covered in the separate vignette <a href="MCMC-diagnostics.html">Visual MCMC diagnostics using the bayesplot package</a>, and graphical posterior predictive checks are covered in <a href="PPC.html">Graphical posterior predictive checks using the bayesplot package</a>.</p>
<div id="plots-for-mcmc-draws" class="section level2">
<h2 class="hasAnchor">
<a href="#plots-for-mcmc-draws" class="anchor"></a>Plots for MCMC draws</h2>
<p>The <strong>bayesplot</strong> package provides various plotting functions for visualizing Markov chain Monte Carlo (MCMC) draws from the posterior distribution of the parameters of a Bayesian model.</p>
<p>In this vignette we’ll use draws obtained using the <code>stan_glm</code> function in the <strong>rstanarm</strong> package (Gabry and Goodrich, 2016), but MCMC draws from using any package can be used with the functions in the <strong>bayesplot</strong> package. See, for example, <strong>brms</strong> (which, like <strong>rstanarm</strong>, calls the <strong>rstan</strong> package internally to use <a href="http://mc-stan.org/">Stan</a>’s MCMC sampler).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"rstanarm"</span>)
fit &lt;-<span class="st"> </span><span class="kw">stan_glm</span>(
  mpg ~<span class="st"> </span>., <span class="co"># ~ . includes all other variables in dataset</span>
  <span class="dt">data =</span> mtcars,
  <span class="dt">chains =</span> <span class="dv">4</span>,
  <span class="dt">iter =</span> <span class="dv">2000</span>,
  <span class="dt">seed =</span> <span class="dv">1111</span>
)
<span class="kw">print</span>(fit)</code></pre></div>
<pre><code>stan_glm
 family:   gaussian [identity]
 formula:  mpg ~ .
 num. obs: 32
------

Estimates:
            Median MAD_SD
(Intercept) 12.2   18.2  
cyl         -0.1    1.1  
disp         0.0    0.0  
hp           0.0    0.0  
drat         0.8    1.7  
wt          -3.6    2.0  
qsec         0.8    0.7  
vs           0.3    2.2  
am           2.5    2.1  
gear         0.7    1.6  
carb        -0.3    0.9  
sigma        2.8    0.4  

Sample avg. posterior predictive 
distribution of y (X = xbar):
         Median MAD_SD
mean_PPD 20.1    0.7  

------
For info on the priors used see help('prior_summary.stanreg').</code></pre>
<p>To use the posterior draws with the functions in the <strong>bayesplot</strong> package we’ll extract them from the fitted model object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">posterior &lt;-<span class="st"> </span><span class="kw">as.array</span>(fit)
<span class="kw">dim</span>(posterior)</code></pre></div>
<pre><code>[1] 1000    4   12</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dimnames</span>(posterior)</code></pre></div>
<pre><code>$iterations
NULL

$chains
[1] "chain:1" "chain:2" "chain:3" "chain:4"

$parameters
 [1] "(Intercept)" "cyl"         "disp"        "hp"          "drat"       
 [6] "wt"          "qsec"        "vs"          "am"          "gear"       
[11] "carb"        "sigma"      </code></pre>
<div id="interval-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#interval-estimates" class="anchor"></a>Interval estimates</h3>
<p>Posterior intervals for the parameters can be plotted using the <code>mcmc_intervals</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"bayesplot"</span>)
<span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"red"</span>)
<span class="kw"><a href="../reference/MCMC-intervals.html">mcmc_intervals</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"cyl"</span>, <span class="st">"drat"</span>, <span class="st">"am"</span>, <span class="st">"sigma"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_intervals-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The default is to show 50% intervals (the thick lines) and 90% intervals (the thinner outer lines). These defaults can be changed using the <code>prob</code> and <code>prob_outer</code> arguments, respectively. The points in the above plot are posterior medians. The <code>point_est</code> argument can be used to select posterior means instead or to omit the point estimates.</p>
<p>To show the uncertainty intervals as shaded areas under the estimated posterior density curves we can use the <code>mcmc_areas</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-intervals.html">mcmc_areas</a></span>(
  posterior,
  <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"cyl"</span>, <span class="st">"drat"</span>, <span class="st">"am"</span>, <span class="st">"sigma"</span>),
  <span class="dt">prob =</span> <span class="fl">0.8</span>, <span class="co"># 80% intervals</span>
  <span class="dt">prob_outer =</span> <span class="fl">0.99</span>, <span class="co"># 99%</span>
  <span class="dt">point_est =</span> <span class="st">"mean"</span>
)</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_areas-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div id="histograms-and-density-estimates" class="section level3">
<h3 class="hasAnchor">
<a href="#histograms-and-density-estimates" class="anchor"></a>Histograms and density estimates</h3>
<p>Histograms or kernel density estimates of posterior distributions of the various model parameters can be visualized using the functions described on the <code>MCMC-distributions</code> page in the <strong>bayesplot</strong> documentation.</p>
<div id="histograms" class="section level4">
<h4 class="hasAnchor">
<a href="#histograms" class="anchor"></a>Histograms</h4>
<p>The <code>mcmc_hist</code> and <code>mcmc_dens</code> functions plot posterior distributions (combining all chains):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"green"</span>)
<span class="kw"><a href="../reference/MCMC-distributions.html">mcmc_hist</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"am"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_hist-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-distributions.html">mcmc_dens</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"am"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_hist-2.png" width="60%" style="display: block; margin: auto;"></p>
<p>To view the four Markov chain separately we can use <code>mcmc_hist_by_chain</code>, <code>mcmc_dens_overlay</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"brightblue"</span>)
<span class="kw"><a href="../reference/MCMC-distributions.html">mcmc_hist_by_chain</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"am"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_hist_by_chain-1.png" width="60%" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-distributions.html">mcmc_dens_overlay</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"am"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_hist_by_chain-2.png" width="60%" style="display: block; margin: auto;"></p>
<p>The <code>mcmc_violin</code> function also plots the density estimates of each chain as violins with horizontal lines at user-specified quantiles:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-distributions.html">mcmc_violin</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"am"</span>), <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_violin-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="scatterplots" class="section level3">
<h3 class="hasAnchor">
<a href="#scatterplots" class="anchor"></a>Scatterplots</h3>
<p>The <code>mcmc_scatter</code> function creates a scatterplot with two parameters:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"gray"</span>)
<span class="kw"><a href="../reference/MCMC-scatterplots.html">mcmc_scatter</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"wt"</span>), <span class="dt">size =</span> <span class="fl">1.5</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_scatter-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The <code>mcmc_hex</code> function creates a similar plot but using hexagonal binning, which can be useful to avoid overplotting:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-scatterplots.html">mcmc_hex</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"wt"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_hex-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>In addition to <code>mcmc_scatter</code> and <code>mcmc_hex</code>, as of <strong>bayesplot</strong> version 1.2.0 an <code>mcmc_pairs</code> function for creating pairs plots with more than two parameters is available. Examples will eventually be included in this vignette. For now see <code>help("mcmc_pairs")</code>.</p>
</div>
<div id="traceplots" class="section level3">
<h3 class="hasAnchor">
<a href="#traceplots" class="anchor"></a>Traceplots</h3>
<p>The <code>mcmc_trace</code> function creates standard traceplots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"blue"</span>)
<span class="kw"><a href="../reference/MCMC-traces.html">mcmc_trace</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"sigma"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_trace-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>If it’s hard to see the difference between the chains we can change to a mixed color scheme, for example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"mix-blue-red"</span>)
<span class="kw"><a href="../reference/MCMC-traces.html">mcmc_trace</a></span>(posterior, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"wt"</span>, <span class="st">"sigma"</span>),
           <span class="dt">facet_args =</span> <span class="kw">list</span>(<span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">strip.position =</span> <span class="st">"left"</span>))</code></pre></div>
<p><img src="MCMC_files/figure-html/change-scheme-1.png" width="60%" style="display: block; margin: auto;"> The code above also illustrates the use of the <code>facet_args</code> argument, which is a list of parameters passed to <code>facet_wrap</code> in <strong>ggplot2</strong>. Specifying <code>ncol=1</code> means the traceplots will be stacked in a single column rather than placed side by side, and <code>strip.position="left"</code> moves the facet labels to the y-axis (instead of above each facet).</p>
<p>The <a href="https://CRAN.R-project.org/package=viridis"><code>"viridis"</code> color scheme</a> is also useful for traceplots because it is comprised of very distinct colors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/bayesplot-colors.html">color_scheme_set</a></span>(<span class="st">"viridis"</span>)
<span class="kw"><a href="../reference/MCMC-traces.html">mcmc_trace</a></span>(posterior, <span class="dt">pars =</span> <span class="st">"(Intercept)"</span>)</code></pre></div>
<p><img src="MCMC_files/figure-html/viridis-scheme-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The <code>mcmc_trace_highlight</code> function uses points instead of lines and reduces the opacity of all but a single chain (which is specified using the <code>highlight</code> argument).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/MCMC-traces.html">mcmc_trace_highlight</a></span>(posterior, <span class="dt">pars =</span> <span class="st">"sigma"</span>, <span class="dt">highlight =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="MCMC_files/figure-html/mcmc_trace_highlight-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Gabry, J., and Goodrich, B. (2017). rstanarm: Bayesian Applied Regression Modeling via Stan. R package version 2.14.1. <a href="http://mc-stan.org/interfaces/rstanarm.html" class="uri">http://mc-stan.org/interfaces/rstanarm.html</a>, <a href="https://CRAN.R-project.org/package=rstanarm" class="uri">https://CRAN.R-project.org/package=rstanarm</a></p>
<p>Gelman, A., Carlin, J. B., Stern, H. S., Dunson, D. B., Vehtari, A., and Rubin, D. B. (2013). <em>Bayesian Data Analysis</em>. Chapman &amp; Hall/CRC Press, London, third edition.</p>
<p>Stan Development Team. (2016). <em>Stan Modeling Language Users Guide and Reference Manual</em>. <a href="http://mc-stan.org/documentation/" class="uri">http://mc-stan.org/documentation/</a></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#plots-for-mcmc-draws">Plots for MCMC draws</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jonah Gabry.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
